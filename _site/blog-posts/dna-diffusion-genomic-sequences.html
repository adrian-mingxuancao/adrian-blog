<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Adrian">
<meta name="dcterms.date" content="2025-08-19">

<title>Comparative Analysis: DNA-Diffusion and DiscDiff in Genomic Sequence Generation – Adrian’s Generative Genomics Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-e2ec580592f0bca8c79b521847304919.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Adrian’s Generative Genomics Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog-posts/"> 
<span class="menu-text">Blog Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#dna-diffusion-diffusion-for-cell-type-specific-regulatory-dna-design" id="toc-dna-diffusion-diffusion-for-cell-type-specific-regulatory-dna-design" class="nav-link" data-scroll-target="#dna-diffusion-diffusion-for-cell-type-specific-regulatory-dna-design">DNA-Diffusion: Diffusion for Cell Type-Specific Regulatory DNA Design</a></li>
  <li><a href="#discdiff-latent-diffusion-model-for-dna-sequence-generation" id="toc-discdiff-latent-diffusion-model-for-dna-sequence-generation" class="nav-link" data-scroll-target="#discdiff-latent-diffusion-model-for-dna-sequence-generation">DiscDiff: Latent Diffusion Model for DNA Sequence Generation</a></li>
  <li><a href="#why-diffusion-models-diffusion-vs.-autoregressive-transformers" id="toc-why-diffusion-models-diffusion-vs.-autoregressive-transformers" class="nav-link" data-scroll-target="#why-diffusion-models-diffusion-vs.-autoregressive-transformers">Why Diffusion Models? (Diffusion vs.&nbsp;Autoregressive Transformers)</a>
  <ul class="collapse">
  <li><a href="#avoiding-mode-collapse-enhancing-diversity" id="toc-avoiding-mode-collapse-enhancing-diversity" class="nav-link" data-scroll-target="#avoiding-mode-collapse-enhancing-diversity">Avoiding Mode Collapse &amp; Enhancing Diversity</a></li>
  <li><a href="#iterative-refinement-and-global-coherence" id="toc-iterative-refinement-and-global-coherence" class="nav-link" data-scroll-target="#iterative-refinement-and-global-coherence">Iterative Refinement and Global Coherence</a></li>
  <li><a href="#handling-long-contexts" id="toc-handling-long-contexts" class="nav-link" data-scroll-target="#handling-long-contexts">Handling Long Contexts</a></li>
  <li><a href="#conditional-generation-is-straightforward" id="toc-conditional-generation-is-straightforward" class="nav-link" data-scroll-target="#conditional-generation-is-straightforward">Conditional Generation is Straightforward</a></li>
  <li><a href="#discrete-data-challenges-and-solutions" id="toc-discrete-data-challenges-and-solutions" class="nav-link" data-scroll-target="#discrete-data-challenges-and-solutions">Discrete Data Challenges and Solutions</a></li>
  </ul></li>
  <li><a href="#comparison-with-prior-and-related-models" id="toc-comparison-with-prior-and-related-models" class="nav-link" data-scroll-target="#comparison-with-prior-and-related-models">Comparison with Prior and Related Models</a></li>
  <li><a href="#limitations-and-applications-so-what-of-generative-genomics" id="toc-limitations-and-applications-so-what-of-generative-genomics" class="nav-link" data-scroll-target="#limitations-and-applications-so-what-of-generative-genomics">Limitations and Applications – “So What” of Generative Genomics?</a>
  <ul class="collapse">
  <li><a href="#synthetic-biology-gene-therapy-design" id="toc-synthetic-biology-gene-therapy-design" class="nav-link" data-scroll-target="#synthetic-biology-gene-therapy-design">Synthetic Biology &amp; Gene Therapy Design</a></li>
  <li><a href="#data-augmentation-and-privacy" id="toc-data-augmentation-and-privacy" class="nav-link" data-scroll-target="#data-augmentation-and-privacy">Data Augmentation and Privacy</a></li>
  <li><a href="#understanding-regulatory-grammar" id="toc-understanding-regulatory-grammar" class="nav-link" data-scroll-target="#understanding-regulatory-grammar">Understanding Regulatory Grammar</a></li>
  <li><a href="#limitations-and-future-directions" id="toc-limitations-and-future-directions" class="nav-link" data-scroll-target="#limitations-and-future-directions">Limitations and Future Directions</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Comparative Analysis: DNA-Diffusion and DiscDiff in Genomic Sequence Generation</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Genomics</div>
    <div class="quarto-category">Generative Modeling</div>
    <div class="quarto-category">Diffusion Models</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Adrian </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 19, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Generative AI models are increasingly being applied to <strong>genomic sequences</strong> for tasks like designing synthetic DNA with desired regulatory functions. Two recent approaches – <strong>DNA-Diffusion</strong> and <strong>DiscDiff</strong> – explore <em>diffusion models</em> for DNA sequence generation from different angles. <strong>DNA-Diffusion</strong> (2024) leverages a diffusion model to <strong>generate synthetic regulatory DNA elements</strong> (short sequences ~200 bp) conditioned on cell type, aiming to control chromatin accessibility and gene expression. <strong>DiscDiff</strong> (2024) introduces a framework for <strong>DNA sequence generation across species</strong> using a latent diffusion model, coupled with a post-processing algorithm, to produce realistic DNA sequences (including regulatory regions and gene sequences) with high fidelity. Both models set new milestones in DNA generative modeling: DNA-Diffusion demonstrates the ability to create <em>cell type-specific</em> enhancers in silico, while DiscDiff achieves state-of-the-art performance in generating both short and long DNA sequences across multiple species. Despite sharing the diffusion paradigm, they differ in methodology and objectives – DNA-Diffusion focuses on <strong>conditional generation</strong> of regulatory sequences for synthetic biology, whereas DiscDiff proposes a <strong>latent discrete diffusion</strong> approach to broadly model genomic sequences. Below, we discuss each model’s achievements and methods, compare their similarities and differences (including how DiscDiff tackles a key concern in DNA-Diffusion’s design), and examine why diffusion models were chosen over traditional sequence models. We also highlight the data used, connections to prior DNA language models, and the limitations and potential applications of these generative genomics models in the context of <em>AI for virtual cells</em> and beyond.</p>
</section>
<section id="dna-diffusion-diffusion-for-cell-type-specific-regulatory-dna-design" class="level2">
<h2 class="anchored" data-anchor-id="dna-diffusion-diffusion-for-cell-type-specific-regulatory-dna-design">DNA-Diffusion: Diffusion for Cell Type-Specific Regulatory DNA Design</h2>
<p><strong>DNA-Diffusion</strong> (Ferreira DaSilva et al.&nbsp;2024) is a conditional diffusion model developed to <strong>design synthetic DNA regulatory elements (enhancers)</strong> that can drive gene expression in a <strong>cell type-specific</strong> manner. The model’s goal is to aid synthetic biology and gene therapy by generating 200 bp DNA sequences with desired regulatory activity – for example, creating an enhancer sequence that is active (open chromatin and transcriptionally potent) in one cell type but not in others. To achieve this, DNA-Diffusion uses the standard diffusion model framework adapted to one-dimensional DNA sequences:</p>
<ul>
<li><p><strong>Architecture &amp; Method</strong>: DNA-Diffusion employs a <strong>U-Net convolutional network</strong> (inspired by image diffusion models) that iteratively denoises a noisy sequence input. Each DNA sequence is represented as a one-hot encoded matrix (4 channels for A/C/G/T by 200 bp length). During the <em>forward diffusion</em> process, <strong>Gaussian noise</strong> is added to these one-hot sequence vectors over multiple timesteps until the sequence becomes nearly random noise. Training involves learning the <em>reverse diffusion</em> – the U-Net is given a noisy sequence plus a time-step embedding and a <strong>cell type condition</strong> label, and it learns to predict and remove the noise to recover the original sequence at that timestep. Essentially, the model is <strong>conditioned on cell type</strong> so that it will generate sequences with features specific to that cell type’s open chromatin profiles. After training, new sequences can be generated by starting from random noise and iteratively denoising it 50 steps down to a synthetic DNA sequence that “reflects the characteristics of the target cell type”. The diffusion model “receives three inputs: DNA sequences, a timestep, and cell type labels” and uses the cell-type embedding to guide the sequence generation toward the desired regulatory profile</p></li>
<li><p><strong>Key Achievement</strong>: DNA-Diffusion showed that diffusion models can “<strong>robustly generate DNA sequences with cell type-specific regulatory potential</strong>.” In evaluations, the authors verified that the synthetic sequences retained hallmark properties of real (endogenous) regulatory DNA. For instance, generated sequences had realistic combinations of transcription factor binding sites and were predicted (by external models) to produce the intended chromatin accessibility and gene expression patterns in the target cell types. In fact, using state-of-the-art predictive models (like Enformer/AlphaGenome-style epigenomic predictors), they found that DNA-Diffusion sequences could <strong>activate genes and open chromatin</strong> in silico similarly to or even beyond real enhancers for those cell contexts. This demonstrates the potential of the model to <em>modulate gene expression</em> via designed DNA, paving the way for applications in mammalian synthetic biology and precision gene therapy.</p></li>
<li><p><strong>Data Used (Endogenous vs Synthetic)</strong>: DNA-Diffusion was trained on <strong>real genomic sequences</strong> – specifically, <strong>DNase hypersensitive sites (DHS)</strong> of length ~200 bp from a few well-studied human cell lines (GM12878 lymphoblastoid cells, K562 erythroleukemia cells, and HepG2 liver cells). These <strong>“endogenous” sequences</strong> are actual regulatory DNA elements native to the human genome that were accessible (open chromatin) in specific cell types, drawn from a DHS index dataset (ENCODE/Roadmap epigenomics data) curated by Meuleman et al.. In the context of the paper, “<em>endogenous</em>” data refers to real biological sequences present in the genome, as opposed to synthetic sequences generated by the model. The authors ensured that the diffusion model’s outputs were biologically plausible by comparing them to such endogenous sequences. Notably, they checked that the <strong>synthetic enhancers</strong> did not trivially copy training examples – out of hundreds of thousands of generated sequences, only a handful were exact matches to known DHS sequences (e.g.&nbsp;~50 overlaps for GM12878, indicating high novelty/diversity). This indicates the model was creating novel sequence variants rather than memorizing, a critical property for generative design.</p></li>
<li><p><strong>Addressing Diffusion on Discrete Data</strong>: One methodological detail is that DNA-Diffusion applied <strong>Gaussian noise to one-hot vectors</strong> – meaning during noising, a DNA sequence (which initially has binary 0/1 values in each nucleotide channel) becomes a continuous valued matrix. This is a straightforward adaptation of image/text diffusion to DNA, but it introduces <em>intermediate states that are not valid DNA sequences</em> (e.g.&nbsp;partial activation of multiple nucleotide channels). The model must learn to navigate these continuous states and ultimately produce a valid discrete sequence (usually by taking the argmax base at each position after the final denoising step). The authors used a fixed noise schedule (50 diffusion steps) and trained the U-Net to predict the added noise at each step so that it can subtract it out. While effective, <strong>using standard normal noise on one-hot encodings</strong> can cause a kind of “<em>rounding</em>” problem: the model’s output before discretization might be ambiguous or unrealistic (like 0.5 A + 0.5 C at one position). DNA-Diffusion dealt with this by relying on the neural network to produce sharp outputs that can be thresholded into A/C/G/T. However, this approach left a space for improvement – as we will see, DiscDiff explicitly tackles the challenge of discrete sequence diffusion by altering how the diffusion is performed (hint: via a latent space encoding).</p></li>
</ul>
<p>In summary, DNA-Diffusion’s methodology demonstrated <strong>how diffusion models can be adapted to DNA sequence generation</strong> with conditioning. It achieved the generation of functional, cell-specific DNA sequences and established a baseline for <em>controlling gene regulatory elements via generative models</em>. One primary concern with this approach is the continuous noising of discrete data, which can introduce inaccuracies. The <strong>DiscDiff</strong> paper addresses this concern through an alternative diffusion strategy.</p>
</section>
<section id="discdiff-latent-diffusion-model-for-dna-sequence-generation" class="level2">
<h2 class="anchored" data-anchor-id="discdiff-latent-diffusion-model-for-dna-sequence-generation">DiscDiff: Latent Diffusion Model for DNA Sequence Generation</h2>
<p><strong>DiscDiff</strong> (Li et al.&nbsp;2024) presents a novel two-part framework for DNA generation, consisting of (1) <strong>DiscDiff</strong>, a latent diffusion model (LDM) tailored to discrete sequences, and (2) <strong>Absorb-Escape</strong>, a post-processing algorithm to refine generated sequences. The motivation behind DiscDiff is to overcome the unique challenges of applying diffusion models to DNA, particularly the discrete nature of nucleotide sequences and the need for diverse, high-fidelity outputs across different sequence types (regulatory regions and protein-coding sequences, potentially in multiple species). DiscDiff’s approach can be seen as a more <em>general-purpose DNA generator</em>: it is trained on a large multi-species DNA dataset and can generate both short sequences (like promoters/enhancers) and longer sequences (gene regions up to 2 kb). Importantly, DiscDiff directly addresses the <strong>“continuous vs discrete” mismatch</strong> present in models like DNA-Diffusion by introducing a latent representation for sequences and a correction mechanism for any errors in conversion between latent and actual DNA.</p>
<ul>
<li><p><strong>Latent Diffusion Methodology</strong>: Rather than diffusing on one-hot DNA directly, DiscDiff first <strong>encodes DNA sequences into a continuous latent space</strong> using a specialized autoencoder (in fact, they experiment with architectures including CNNs and transformers – e.g.&nbsp;a Swin-transformer – for the encoder/decoder, even noting that incorporating components like those in Enformer improved performance in one variant). The encoder compresses a DNA sequence into a latent vector (of lower dimension), and the decoder can reconstruct the sequence from this latent (this is akin to a VAE, but they focus on minimizing reconstruction error). Once this <strong>DNA-to-latent mapping</strong> is established, a <strong>diffusion model is trained in the latent space</strong>: Gaussian noise is added to the latent vectors rather than to the raw sequence, and a diffusion U-Net (or similar) learns to denoise in latent space. Because the latent space is continuous by construction, the diffusion process here is naturally handled with continuous noise, avoiding the problem of generating physically impossible intermediate DNA states. After training, DiscDiff generates new sequences by sampling a random latent vector, iteratively denoising it via the diffusion model, and then passing the final denoised latent through the decoder to produce a DNA sequence.</p></li>
<li><p><strong>Absorb-Escape (Refinement Step)</strong>: A critical innovation in DiscDiff is the <strong>Absorb-Escape algorithm</strong>, which aims to fix any “<em>rounding errors</em>” or local inconsistencies that arise when converting the denoised latent back into a discrete sequence. Even with a good autoencoder, the decoded sequence might have minor errors (e.g.&nbsp;low-probability nucleotides where there should be a clear choice). Absorb-Escape addresses this by leveraging an <strong>autoregressive model</strong> in a post-hoc manner. Specifically, they use <strong>Hyena</strong>, a state-of-the-art autoregressive sequence model, to scan through the generated sequence and correct mistakes. The Absorb-Escape algorithm works by “<em>absorbing</em>” the reliable parts of the sequence and “<em>escaping</em>” (redoing) the uncertain parts, effectively combining the <strong>strengths of diffusion (global realism and diversity)</strong> with the <strong>strengths of autoregressive models (local coherence and grammar)</strong>. This hybrid approach was shown to significantly improve the quality of generated sequences – for example, Absorb-Escape improved DiscDiff’s performance by ~4% on long sequences and enhanced the model’s ability to precisely match known motif patterns. In essence, DiscDiff generates a draft sequence in one shot via latent diffusion, and then Absorb-Escape fine-tunes that sequence to eliminate small errors, much like an editor refining a rough draft.</p></li>
<li><p><strong>Achievements and Evaluation</strong>: DiscDiff is reported to <strong>outperform prior generative models</strong> for DNA in both <strong>short sequence generation</strong> (enhancers, promoters) and <strong>long sequence generation</strong> (gene regions). It was evaluated on a suite of metrics, including a <em>latent Frechet distance</em> (S-FID) measuring how close the distribution of generated sequences is to real sequences in a learned feature space, and <em>motif distribution correlation</em>, which checks if the frequency of biological motifs (like transcription factor binding sequences) in generated DNA matches those in real DNA. DiscDiff had the <strong>smallest latent distance and highest motif correlation</strong> compared to other baseline models (including earlier diffusion models and an autoregressive transformer), indicating its samples are both realistic and capture the underlying genomic patterns very well. Notably, the authors compared DiscDiff to a discrete diffusion model (DDSM) and to a transformer-based generative model, and DiscDiff achieved the best trade-off of accuracy and diversity. They also performed a head-to-head comparison with an autoregressive DNA language model (Hyena) on conditional generation tasks; each had strengths for certain motif types, but combining them via Absorb-Escape yielded the most realistic sequences overall。</p></li>
<li><p><strong>Data Used</strong>: A major contribution of DiscDiff is the introduction of EPD-GenDNA, a comprehensive multi-species dataset of DNA sequences for generative modeling. EPD-GenDNA is built from the Eukaryotic Promoter Database and contains <strong>160,000 unique sequences</strong> from <strong>15 species</strong>, including both <strong>regulatory regions (promoters/enhancers)</strong> and <strong>protein-coding segments</strong>. Sequence lengths in the dataset are either 256 bp (promoter-centered windows) or 2048 bp (extended genomic regions around transcription start sites). Each sequence comes with rich annotations like species and cell type of origin and gene expression info. This dataset allowed DiscDiff to be the <strong>first DNA diffusion model tested across multiple species</strong> (prior works were largely single-species and much smaller). By training on this diverse data, DiscDiff learned to generate DNA that is not just human-like but captures broader genomic “languages.” The diversity of training data is reflected in its outputs: DiscDiff can sample novel DNA sequences that maintain <strong>natural diversity</strong> (measured by unique <em>n</em>-gram content close to real data). In fact, the authors emphasize that <strong>diversity is a key metric for genome sequence generation</strong>, to avoid mode collapse and to ensure synthetic sequences explore the full space of possibilities. DiscDiff’s diffusion approach, combined with latent compression, was explicitly designed to promote diversity while still matching biological distributions.</p></li>
<li><p><strong>Key Differences from DNA-Diffusion</strong>: DiscDiff directly tackled the main concern one might have with a method like DNA-Diffusion: <em>the use of standard Gaussian noise on discrete sequences</em>. In DNA-Diffusion, adding continuous noise to one-hot DNA could lead to off-manifold intermediate states that the model must correct. DiscDiff avoids diffusing on raw sequences; instead, it <strong>performs diffusion in a learned continuous latent space</strong> where noise application is natural. The consequence is fewer downstream errors when decoding sequences. And if errors do occur, the Absorb-Escape step fixes them, resulting in highly realistic final sequences. In summary, DiscDiff’s methodology is more complex (involving an encoder, a diffusion model, and an AR refiner), but this complexity is justified by significantly improved quality and the ability to handle long sequences. DiscDiff also operates largely <em>unconditionally</em> or with broad conditioning (it can generate sequences without needing a specific cell type label, or potentially conditioned on species or desired motifs), whereas DNA-Diffusion was a fully <strong>conditional model (cell type-specific)</strong>. Despite these differences, both models share the core idea that <strong>diffusion models can generate diverse, high-fidelity DNA</strong> – they just implement it in different ways to accommodate the discrete sequence data.</p></li>
</ul>
</section>
<section id="why-diffusion-models-diffusion-vs.-autoregressive-transformers" class="level2">
<h2 class="anchored" data-anchor-id="why-diffusion-models-diffusion-vs.-autoregressive-transformers">Why Diffusion Models? (Diffusion vs.&nbsp;Autoregressive Transformers)</h2>
<p>A central question is why these works chose <em>diffusion models</em> for DNA generation instead of more traditional autoregressive (AR) sequence models like Transformers or RNN-based language models. Several reasons emerge from the papers:</p>
<section id="avoiding-mode-collapse-enhancing-diversity" class="level3">
<h3 class="anchored" data-anchor-id="avoiding-mode-collapse-enhancing-diversity">Avoiding Mode Collapse &amp; Enhancing Diversity</h3>
<p>Earlier attempts at DNA generation used Generative Adversarial Networks (GANs) or even direct CNN-based generators, but those often suffered from mode collapse and limited diversity – i.e.&nbsp;they tended to produce very similar or repetitive sequences, failing to cover the full variability of genomic patterns. Autoregressive language models can also become over-confident and repetitive, essentially learning to generate the most frequent patterns and ignoring rarer variants. In genomic sequence generation, such loss of diversity is “detrimental” because capturing the wide range of possible sequences (especially for non-coding DNA where many different motifs and combinations exist) is crucial. <strong>Diffusion models naturally encourage diversity</strong> by their stochastic sampling process – each diffusion run can produce a different outcome, and there’s no easy way for the model to collapse to a single mode since it has to learn to reconstruct data from random noise. Dhariwal &amp; Nichol (2021) observed that diffusion models can outperform GANs in sample diversity. In the context of DNA, DiscDiff explicitly highlights that autoregressive transformers “<em>generate samples with lower diversity than diffusion models</em>” and tend to repeat themselves, whereas diffusion models produce a richer variety of outputs. This is a major motivation: to generate truly novel DNA sequences (for synthetic biology or data augmentation), one needs the generative model to explore many modes of the sequence distribution, which diffusion is well-suited for.</p>
</section>
<section id="iterative-refinement-and-global-coherence" class="level3">
<h3 class="anchored" data-anchor-id="iterative-refinement-and-global-coherence">Iterative Refinement and Global Coherence</h3>
<p>Diffusion models generate data by iterative denoising, which allows them to make large-scale decisions in a sequence in a coarse-to-fine manner. This can help with <strong>global coherence</strong> of the sequence in a way that one-base-at-a-time generation sometimes struggles with. An AR model decides each next nucleotide based only on previous ones; if it makes a bad choice early, it can derail the rest of the sequence (accumulating errors). This can lead to issues like local repetitions or inconsistent long-range structure in AR outputs. Diffusion, in contrast, starts with a holistic (if noisy) view and refines everything together, potentially balancing local and global features as it denoises. In DNA-Diffusion’s case, the U-Net has access to the entire sequence and the cell type context at once, so it can, for example, ensure that if a certain transcription factor motif is needed at the start and another at the end, it can place both during the denoising process. This iterative global refinement tends to produce sequences that capture higher-order dependencies (like spacing between motifs, or overall GC-content) more naturally. That said, diffusion models sometimes under-perform in local syntax (e.g.&nbsp;occasional minor errors in a sequence) compared to AR models, which is why DiscDiff introduced Absorb-Escape to inject local autoregressive strength into the final output.</p>
</section>
<section id="handling-long-contexts" class="level3">
<h3 class="anchored" data-anchor-id="handling-long-contexts">Handling Long Contexts</h3>
<p>Genomic sequences can be very long (thousands to millions of bases). Autoregressive transformers face <strong>computational challenges</strong> with long contexts due to quadratic attention scaling and memory limits. Notably, the Evo 2 language model (discussed below) addresses this with 1 million token context, but it requires enormous model sizes (billions of parameters) and specialized training regimes. Diffusion models, especially in latent space, offer an alternative: compress the sequence and then generate. DiscDiff’s latent diffusion is an example – by encoding 2048bp sequences into a latent, they sidestep dealing with thousands of tokens in the generative model directly. This makes the generation of long sequences more tractable on modest computational budgets. In effect, diffusion models can leverage <strong>latent representations and iterative sampling</strong> to cover long-range genomic structure without needing an exorbitantly large model at generation time. This is partly why DiscDiff could demonstrate multi-kilobase sequence generation with high fidelity.</p>
</section>
<section id="conditional-generation-is-straightforward" class="level3">
<h3 class="anchored" data-anchor-id="conditional-generation-is-straightforward">Conditional Generation is Straightforward</h3>
<p>Both DNA-Diffusion and DiscDiff needed to condition on certain information (cell type for DNA-Diffusion; in DiscDiff’s case, they considered conditional generation in experiments, such as giving the model a motif to include or a species label). In diffusion models, conditioning can often be done by concatenating the condition to the input or modifying the denoising network (e.g.&nbsp;through cross-attention or FiLM layers) without fundamentally changing the generation process. DNA-Diffusion simply concatenated a one-hot cell type vector as additional input channels to the U-Net and as a global label, which is a natural extension of image diffusion techniques. In contrast, conditioning an autoregressive DNA model on metadata might require special tokens or complex prompt design, and ensuring the model actually respects the condition can be tricky. The diffusion approach thus provided a clean way to inject context like “generate an enhancer for K562 cells” into the process. Additionally, diffusion models can integrate multiple conditions (if needed) by altering the denoising score function, offering flexibility for future extensions (e.g.&nbsp;generate a sequence with <strong>both</strong> a certain GC content <strong>and</strong> a specific histone mark profile – one could condition the diffusion model on both).</p>
</section>
<section id="discrete-data-challenges-and-solutions" class="level3">
<h3 class="anchored" data-anchor-id="discrete-data-challenges-and-solutions">Discrete Data Challenges and Solutions</h3>
<p>A noteworthy point is that vanilla diffusion was designed for continuous data (like pixel intensities). Applying it to DNA (discrete alphabet) is non-trivial, and yet both papers show viable solutions. DNA-Diffusion took the simpler route of using continuous noise on one-hot vectors, effectively <em>pretending DNA is like an image</em> and relying on the network to snap it back to one-hot. This works but could introduce errors – imagine the model outputs a 0.8 for “A” and 0.7 for “C” at one position, which base do you choose? It requires a hard decision that could slightly perturb the sequence’s validity (this could potentially create an out-of-distribution sequence if not careful). <strong>DiscDiff’s latent approach is a more principled solution</strong>: by learning a continuous embedding of DNA, the diffusion model always operates in a continuous space that (ideally) corresponds to valid sequences when decoded. The <strong>problem of “rounding”</strong> (continuous outputs not mapping cleanly to discrete tokens) is alleviated by design and explicitly corrected with Absorb-Escape. Moreover, other research has explored <em>discrete diffusion</em> (e.g.&nbsp;<strong>D3PM</strong> or <strong>BitDiffusion</strong> for sequences, and <strong>DDSM</strong> using a Dirichlet distribution for DNA). These confirm that special noise distributions can be used for discrete data, but they tend to be more complex or less efficient. DiscDiff’s contribution was showing that <strong>Latent Diffusion Models (LDMs)</strong> – which were very successful in imaging – can be <strong>adapted to DNA</strong> with new encoder/decoder architectures and a bit of autoregressive help. This substantially reduces the computational cost compared to operating in the original sequence space (DDSM and related discrete DMs were found to be computationally intensive), making diffusion a practical choice for genomics.</p>
<p>In short, diffusion models were chosen because they offer <strong>greater sample diversity, robust global generation</strong> and flexible conditioning, which are valuable for de novo DNA design. The tradeoff is dealing with discrete data issues, but as DiscDiff demonstrated, this can be overcome with a creative combination of techniques. The result is generative models that can imagine a wide variety of realistic DNA sequences – something that a naïve transformer might struggle with, either collapsing to repetitive motifs or requiring an extremely large model to capture all variations. It’s worth noting that the DiscDiff authors still acknowledge the strengths of autoregressive models, which is why they integrated Hyena to handle fine details. Thus, the emerging view is that diffusion and autoregressive approaches can be complementary for biological sequence generation. Some recent works even try to combine them (e.g.&nbsp;using a language model to guide diffusion), and DiscDiff’s Absorb-Escape is a novel instance of such a combination.</p>
</section>
</section>
<section id="comparison-with-prior-and-related-models" class="level2">
<h2 class="anchored" data-anchor-id="comparison-with-prior-and-related-models">Comparison with Prior and Related Models</h2>
<p>Both DNA-Diffusion and DiscDiff build upon and differ from previous approaches to modeling DNA sequences:</p>
<ul>
<li><p><strong>Versus Autoregressive “DNA Language Models”</strong>: Prior to diffusion models, many works applied language-model style architectures to DNA. For example, recurrent networks or Transformers have been used to learn genome sequences and even generate them or score them (e.g.&nbsp;Genomic GPTs, DNABERT for classification, or generative LSTMs for DNA). As DiscDiff’s related work notes, large autoregressive models (including Transformers and state-space models) have indeed been trained on genomic sequences. They can capture sequence dependencies and have seen success in tasks like predicting functional genomic signals or generating DNA one base at a time. Evo&nbsp;2 is a very recent example of a high-profile AR model: Evo&nbsp;2 (Brixi et al.&nbsp;2025) is described as a “biological foundation model” trained on an unprecedented 9.3 trillion DNA bases across all domains of life. Evo&nbsp;2 is designed to both predict functional effects of genetic variation and generate genomic sequences, covering bacteria, archaea, and eukaryotes in one model. In concept, Evo&nbsp;2 and DiscDiff share a grand vision: modeling genomes across all life for design and prediction. We can envision using these models in tandem or comparing insights. For example, DiscDiff could generate candidate promoter sequences and Evo&nbsp;2 (or another foundation model) could evaluate their likelihood or functional scores (since Evo&nbsp;2 can predict epigenomic signals, similar to AlphaGenome described below). Conversely, one could use Evo&nbsp;2 to suggest a rough sequence design and then use DiscDiff’s refinement (via diffusion + Absorb-Escape) to polish certain regions. Both represent steps toward AI-driven genome design. It’s notable that Evo&nbsp;2’s authors explicitly mention enabling “genomic and epigenomic design” as a goal– a goal very much in line with what DNA-Diffusion and DiscDiff are doing on a smaller scale. In summary, DiscDiff and Evo&nbsp;2 share the vision but differ in strategy: <em>DiscDiff demonstrates that with the right model design, even relatively small datasets can yield powerful generative DNA models, whereas Evo&nbsp;2 demonstrates the power of scale and breadth, treating genome modeling as a language modeling problem at internet-scale data</em>.</p></li>
<li><p><strong>Versus Other Diffusion Models (and prior generative work)</strong>: DiscDiff wasn’t the first attempt to adapt diffusion to biological sequences. The authors cite <strong>DDSM (Avdeyev et al.&nbsp;2023)</strong>, a Dirichlet Diffusion Score Model for human DNA. DDSM used a <em>Dirichlet noise distribution</em> to diffuse probability vectors over the DNA alphabet, thereby maintaining a valid distribution at each step (no need for Gaussian with one-hots). It achieved good results especially on conditional tasks, but DDSM still operated in the original sequence length (1024 bp human sequences) and was computationally heavy. DiscDiff differentiates itself by using latent compression (which DDSM did not) and by demonstrating use across species and both coding/regulatory regions. Additionally, <strong>EvoDiff (Alamdari et al.&nbsp;2023)</strong> is mentioned – EvoDiff was a diffusion model for protein sequences (amino acid sequences) which also had to handle discrete tokens. EvoDiff and related models (like ProteinMPNN or Score-based generative models for proteins) illustrate that diffusion can explore sequence space in biology broadly. DiscDiff takes inspiration from these but tailors the approach to DNA. It introduces domain-specific solutions like Absorb-Escape, which were not present in EvoDiff. In terms of performance, DiscDiff reported superior results to previous diffusion models in DNA (including DDSM and a BitDiffusion adaptation). It also compared against <em>D3PM</em> (a discrete diffusion framework from Austin et al.&nbsp;2021) and found DiscDiff’s outputs had closer motif statistics to the ground truth.</p></li>
<li><p><strong>Versus GANs and heuristic sequence design</strong>: Before diffusion models, GANs were tried for DNA – e.g.&nbsp;<strong>EnhancerGAN, FeedbackGAN</strong> for enhancer or promoter generation. These had some success but often produced sequences that, upon evaluation, lacked the full diversity of real data or contained artifacts. For instance, one might get a few strong motifs repeated too often (mode collapse) or sequences that did not integrate multiple regulatory signals well. Both DNA-Diffusion and DiscDiff make the case that diffusion models overcome these issues, producing more varied and realistic sequences. The quantitative metrics in DiscDiff (like diversity and S-FID) back this claim, as DiscDiff’s diversity was very close to the real dataset whereas GAN baselines were presumably worse (the paper notes GAN outputs were less diverse and had mode collapse issues). Another advantage is training stability: GANs are notoriously fickle to train, whereas diffusion model training is a straightforward maximum likelihood training (denoising score matching) which is generally stable albeit slow. This reliability is important if we want a method that can scale or be used as a basis in many labs.</p></li>
</ul>
</section>
<section id="limitations-and-applications-so-what-of-generative-genomics" class="level2">
<h2 class="anchored" data-anchor-id="limitations-and-applications-so-what-of-generative-genomics">Limitations and Applications – “So What” of Generative Genomics?</h2>
<p>While these diffusion models for DNA are technically impressive, one might ask: <strong>what are the practical applications of generating DNA sequences, and what limitations remain?</strong> The papers provide some hints, and we can extrapolate possible uses in research and biotechnology:</p>
<section id="synthetic-biology-gene-therapy-design" class="level3">
<h3 class="anchored" data-anchor-id="synthetic-biology-gene-therapy-design">Synthetic Biology &amp; Gene Therapy Design</h3>
<p>A primary motivation for DNA-Diffusion was to <em>enable precise control of gene expression</em> through synthetic DNA. In practice, this could mean designing <strong>an enhancer or promoter for a therapeutic gene</strong> – for example, creating a regulatory sequence that only turns on a gene in T-cells but not in other cells, or an enhancer that is active only in low-oxygen conditions, etc. Previously, one would have to screen many candidate sequences or rely on minimal motif tweaking. DNA-Diffusion provides a way to <strong>algorithmically design such sequences</strong> by specifying the desired context (cell type) and letting the model generate candidates. This is useful for building gene therapies that need cell-specific targeting or for <strong>engineering cell-based therapies</strong> where you want a gene to be tightly controlled. Another application is in <strong>biomanufacturing</strong>: designing promoters that maximize production of a protein in a cell line (the model could be conditioned on a context representing high expression, for instance). DiscDiff’s authors explicitly mention “<em>potential implications for gene therapy and protein production</em>”– imagining that their model (which can generate entire promoters or even genes) could be used to create novel gene constructs optimized for these purposes. For protein production, one might use DiscDiff to generate coding sequences (synonymous variants of a gene) that have favorable codon usage or mRNA structure for high translation efficiency. Because DiscDiff saw many coding regions, it could conceivably generate a gene sequence that is different from any natural gene but still yields a functional protein, perhaps optimized for expression in a certain organism.</p>
</section>
<section id="data-augmentation-and-privacy" class="level3">
<h3 class="anchored" data-anchor-id="data-augmentation-and-privacy">Data Augmentation and Privacy</h3>
<p>In human genomics research, a big challenge is data sharing and scarcity of labeled examples (and privacy concerns with real genomes). Generative models can create <strong>synthetic genomic data</strong> that mimics real data distribution without containing exact private information. For instance, the Kenneweg et al.&nbsp;(2024) work (arXiv 2412.03278, referenced in DiscDiff context) used diffusion to generate <strong>entire synthetic human genotypes</strong> for exactly this purpose – enabling researchers to train models on synthetic genomes when real ones are protected. While DiscDiff itself didn’t explicitly demonstrate genome-scale generation, its approach to modeling long sequences and multi-species data is a step in that direction. One can imagine using DiscDiff or similar to generate synthetic patient genomes that preserve allele frequency spectra and linkage disequilibrium patterns, which would be extremely valuable for genomic studies while respecting privacy. Even at the smaller scale, synthetic enhancers from DNA-Diffusion could augment datasets for training predictive models: e.g., to train a classifier to identify cell-type-specific enhancers, one could add some model-generated examples to balance classes or explore feature space. Both papers noted that augmenting real data with synthetic data improved performance of downstream models. Thus, generative DNA models can serve as “<em>data generators</em>” to bolster learning tasks in genomics.</p>
</section>
<section id="understanding-regulatory-grammar" class="level3">
<h3 class="anchored" data-anchor-id="understanding-regulatory-grammar">Understanding Regulatory Grammar</h3>
<p>Generative models can be tools for science discovery. By analyzing what the model generates, researchers can infer what patterns it “thinks” are necessary for function. DNA-Diffusion, for example, could be queried to produce multiple enhancers for the same cell type and then one could look for common motifs – if the model consistently inserts a particular motif, it reinforces the evidence that motif is important for that cell type. Conversely, one could ask the model to generate a sequence with certain constraints (if the model supports that) to test hypotheses (e.g., “generate a K562 enhancer sequence that does not contain GATA1 motif” – if the model struggles, that suggests GATA1 is essential for K562 enhancers). DiscDiff’s Absorb-Escape uses an AR model that could potentially assign probabilities to sections of sequence; low confidence regions might correspond to biologically constrained positions (like the TATA box which must be a specific sequence). In this way, generative models can help <strong>identify key sequence features</strong> and perhaps design experiments. The DNA-Diffusion study itself went a step further: they took synthetic sequences and experimentally tested them in silico by inserting them into genomic contexts and using predictive models to see if they activate genes. They even identified cases where synthetic sequences activated genes more strongly than natural ones, suggesting we could design “super-enhancers” or novel regulatory switches that nature hasn’t utilized. This opens a creative side to genomics – using AI to <strong>invent new biological components</strong>.</p>
</section>
<section id="limitations-and-future-directions" class="level3">
<h3 class="anchored" data-anchor-id="limitations-and-future-directions">Limitations and Future Directions</h3>
<ul>
<li><p>Funcational Validity: Despite promising in silico results, a clear limitation is that <strong>experimental validation is needed</strong>. For DNA-Diffusion’s sequences, the real test is to synthesize them and put them in cells to see if they indeed produce the chromatin and expression changes predicted. Models like Enformer (and AlphaGenome) are powerful predictors, but they are not perfect; a sequence predicted to be a strong enhancer might not work in vivo due to chromatin context or 3D genome interactions not accounted for. Thus, one limitation is that generative models may produce sequences that look good to current predictive models (which are trained on known biology), but biology could still surprise us with unintended effects (e.g.&nbsp;the sequence might form a secondary structure or be toxic in some way). DiscDiff’s sequences similarly have not been experimentally tested – they are evaluated by statistical metrics. So a limitation is we don’t yet know if DiscDiff can generate, say, a functional gene that expresses properly, or a promoter that actually drives transcription in a living cell. It’s one thing to match k-mer distributions; it’s another to have all subtle features needed for function. Future work likely will involve moving these models “from silico to vivo,” testing a sample of generated sequences in wet-lab assays (e.g., massively parallel reporter assays for enhancers) to validate their functionality. Until then, there’s a caution that these sequences are hypotheses rather than proven designs.</p></li>
<li><p>Sequence Length and Context: DNA-Diffusion only generates 200 bp sequences in isolation. In reality, an enhancer’s effect might depend on surrounding genomic context or synergy with promoters. Likewise, a 2 kb sequence from DiscDiff might represent a promoter plus some upstream sequence, but it’s still not a full genomic context (AlphaGenome uses 1 Mb context because distal elements can influence genes from far away). So another limitation is <strong>contextual integration</strong>: how do we place these synthetic sequences into a genome and ensure they work as intended? The DNA-Diffusion team addressed this partly by inserting sequences into known genomic loci and using a model to predict changes. They even found that inserting synthetic enhancers into previously inactive loci could <em>create</em> regulatory activity where there was none, hinting that these sequences can impart function in new locations. However, the outcome might differ if multiple enhancers interact or if repressors in a cell also recognize the sequence. So, the limitation is that <em>generative models currently design sequences in a vacuum</em>. A future goal would be <strong>co-designing sequences along with their genomic context</strong> or designing larger genomic constructs (like an entire gene with its regulatory domain). Evo&nbsp;2’s long context might assist here, but diffusion models might need to also scale up to longer ranges or work in tandem with predictive models that account for 3D genome context.</p></li>
<li><p>Evaluation Metrics: Both papers mention the lack of perfect metrics for sequence generation quality. Unlike images where we have FID, or text where we can do human evaluation, for DNA we rely on proxies: k-mer statistics, motif enrichments, predictive model scores. These capture different aspects, but a model could potentially game one metric without truly being optimal (e.g., it could match motif frequency but scramble their order, resulting in non-functional sequence that still “looks” statistically fine). So there’s a limitation in how we measure success. As generative DNA modeling is new, the community is still developing robust benchmarks. DiscDiff’s introduction of S-FID (sequence Frechet Inception Distance using a neural embedding) is one attempt. Over time, more nuanced evaluations, including <strong>evolutionary conservation tests</strong> (e.g., does a generated human sequence avoid something that would be deleterious, as judged by conservation or mutational constraint data?) or <strong>physical property checks</strong> (like DNA shape features), might be incorporated. Until then, the limitation is that a model might produce sequences that pass current tests but fail in aspects we didn’t measure.</p></li>
</ul>
<p>In summary, generative diffusion models for DNA are powerful new tools with various possible applications: from designing gene therapies and synthetic organisms, to augmenting data for AI models, to testing biological hypotheses in silico. They are not without limitations – ensuring functional validity and integrating broader context remain challenges – but they mark a significant step toward “Generative Genomics”. By combining these models with advanced predictors (like Enformer or AlphaGenome) and eventually experimental feedback, we move closer to an era of AI-assisted genome engineering, where we can ask for a biological function and have algorithms propose DNA sequences to achieve it. This synergy of generative and predictive models exemplifies the AIVC concept: a virtuous cycle where AI designs and evaluates virtual cell scenarios, accelerating our understanding and creation of biological systems in a safe, controlled manner. The work on DNA-Diffusion and DiscDiff not only provides two distinct perspectives on using diffusion in genomics, but also <strong>inspires future research</strong> to unify these perspectives – combining the fine control of conditional diffusion with the generality and scale of latent models. As techniques mature, we anticipate diffusion models to play a key role in the <em>“virtual cell” toolbox</em>, generating hypotheses and solutions that human imagination alone might not conceive.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>